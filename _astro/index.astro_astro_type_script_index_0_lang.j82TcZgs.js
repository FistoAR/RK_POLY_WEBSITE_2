const e={searchInput:document.getElementById("search-input"),clearSearch:document.getElementById("clear-search"),categoryRadios:document.querySelectorAll(".category-filter"),sortSelect:document.getElementById("sort"),viewGridBtn:document.getElementById("view-grid"),viewListBtn:document.getElementById("view-list"),productGrid:document.getElementById("product-grid"),productList:document.getElementById("product-list"),filtersSidebar:document.getElementById("filters-sidebar"),mobileOverlay:document.getElementById("mobile-filter-overlay"),toggleFiltersMobile:document.getElementById("toggle-filters-mobile"),toggleFiltersDesktop:document.getElementById("toggle-filters-desktop"),closeFilters:document.getElementById("close-filters"),applyFiltersMobile:document.getElementById("apply-filters-mobile"),filterToggleText:document.getElementById("filter-toggle-text"),filterSectionToggles:document.querySelectorAll(".filter-section-toggle"),clearAllFilters:document.getElementById("clear-all-filters"),resetFiltersBtn:document.getElementById("reset-filters-btn"),activeFiltersContainer:document.getElementById("active-filters-container"),activeFiltersBadge:document.getElementById("active-filters-badge"),productCards:document.querySelectorAll(".product-card"),productCardsLis:document.querySelectorAll(".product-card-list"),categorySections:document.querySelectorAll(".category-section"),categorySectionsLis:document.querySelectorAll(".category-section-list"),productCount:document.getElementById("product-count"),emptyState:document.getElementById("empty-state")};let l={search:"",category:"all",sort:"default",imlOnly:!1},m=!0,u="grid",h=null;function p(){console.log("Initializing filters..."),w(),I(),n(),console.log("Filters initialized successfully")}function w(){const t=new URLSearchParams(window.location.search);if(t.has("q")&&(l.search=t.get("q")||"",e.searchInput&&(e.searchInput.value=l.search),l.search&&e.clearSearch&&e.clearSearch.classList.remove("hidden")),t.has("category")){const r=t.get("category")||"all";l.category=r,e.categoryRadios.forEach(i=>{i.checked=i.dataset.id===r})}t.has("sort")&&(l.sort=t.get("sort")||"default",e.sortSelect&&(e.sortSelect.value=l.sort)),t.has("view")&&(u=t.get("view")||"grid",E())}function o(){const t=new URLSearchParams;l.search&&t.set("q",l.search),l.category!=="all"&&t.set("category",l.category),l.sort!=="default"&&t.set("sort",l.sort),u!=="grid"&&t.set("view",u);const r=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",r)}function I(){e.searchInput?.addEventListener("input",k),e.clearSearch?.addEventListener("click",b),e.categoryRadios.forEach(r=>{r.addEventListener("change",x)}),e.sortSelect?.addEventListener("change",A),e.viewGridBtn?.addEventListener("click",()=>v("grid")),e.viewListBtn?.addEventListener("click",()=>v("list")),e.toggleFiltersMobile?.addEventListener("click",q),e.toggleFiltersDesktop?.addEventListener("click",T),e.closeFilters?.addEventListener("click",f),e.mobileOverlay?.addEventListener("click",f),e.applyFiltersMobile?.addEventListener("click",f),e.filterSectionToggles.forEach(r=>{r.addEventListener("click",M)}),e.clearAllFilters?.addEventListener("click",r=>{r.preventDefault(),S()}),e.resetFiltersBtn?.addEventListener("click",r=>{r.preventDefault(),S()}),document.addEventListener("keydown",D),document.getElementById("imlFilter")?.addEventListener("change",B)}function B(t){const r=t.target;l.imlOnly=r.checked,console.log("IML Filter:",l.imlOnly),y(),n(),o(),d()}function y(){document.querySelectorAll(".category-filter-item").forEach(r=>{const i=r.getAttribute("data-has-iml")==="true",a=r.querySelector('[data-id="all"]')!==null;l.imlOnly?a||i?r.classList.remove("hidden"):r.classList.add("hidden"):r.classList.remove("hidden")})}function F(t,r){return function(...a){h&&clearTimeout(h),h=setTimeout(()=>t(...a),r)}}function k(t){const r=t.target;l.search=r.value.trim(),l.search?e.clearSearch?.classList.remove("hidden"):e.clearSearch?.classList.add("hidden"),F(()=>{n(),o()},300)()}function b(){e.searchInput&&(e.searchInput.value=""),l.search="",e.clearSearch?.classList.add("hidden"),n(),o(),d()}function x(t){const i=t.target.dataset.id||"all";l.category=i,console.log("Category changed to:",i),n(),o(),d()}function A(t){const r=t.target;l.sort=r.value,n(),o()}function v(t){u=t,E(),o()}function E(){u==="grid"?(e.productGrid?.classList.remove("hidden"),e.productList?.classList.add("hidden"),e.viewGridBtn?.classList.add("bg-gray-100","text-gray-900"),e.viewGridBtn?.classList.remove("text-gray-400"),e.viewListBtn?.classList.remove("bg-gray-100","text-gray-900"),e.viewListBtn?.classList.add("text-gray-400")):(e.productGrid?.classList.add("hidden"),e.productList?.classList.remove("hidden"),e.viewListBtn?.classList.add("bg-gray-100","text-gray-900"),e.viewListBtn?.classList.remove("text-gray-400"),e.viewGridBtn?.classList.remove("bg-gray-100","text-gray-900"),e.viewGridBtn?.classList.add("text-gray-400"))}function q(){e.filtersSidebar?.classList.remove("-translate-x-full"),e.mobileOverlay?.classList.remove("hidden"),document.body.style.overflow="hidden"}function f(){e.filtersSidebar?.classList.add("-translate-x-full"),e.mobileOverlay?.classList.add("hidden"),document.body.style.overflow=""}function T(){m=!m,m?(e.filtersSidebar?.classList.remove("lg:hidden"),e.filterToggleText&&(e.filterToggleText.textContent="Hide Filters")):(e.filtersSidebar?.classList.add("lg:hidden"),e.filterToggleText&&(e.filterToggleText.textContent="Show Filters"))}function M(t){const r=t.currentTarget,i=r.dataset.section,a=document.getElementById(`${i}-content`),s=r.querySelector(".filter-chevron");a&&(a.classList.toggle("hidden"),s?.classList.toggle("rotate-180"))}function n(){const t=l.search.toLowerCase();let r=0;e.categorySections.forEach(a=>{const s=a.dataset.categoryId;l.category==="all"||l.category===s?a.classList.remove("hidden"):a.classList.add("hidden")}),e.categorySectionsLis.forEach(a=>{const s=a.dataset.categoryId;l.category==="all"||l.category===s?a.classList.remove("hidden"):a.classList.add("hidden")}),[...e.productCards,...e.productCardsLis].forEach(a=>{const s=a.dataset.category||"",c=a.dataset.name||"",C=a.dataset.iml==="true";let g=!0;l.category!=="all"&&s!==l.category&&(g=!1),l.imlOnly&&!C&&(g=!1),t&&g&&(c.includes(t)||(g=!1)),g?(a.classList.remove("hidden"),a.classList.contains("product-card")&&r++):a.classList.add("hidden")}),e.categorySections.forEach(a=>{a.querySelectorAll(".product-card:not(.hidden)").length===0&&a.classList.add("hidden")}),e.categorySectionsLis.forEach(a=>{a.querySelectorAll(".product-card-list:not(.hidden)").length===0&&a.classList.add("hidden")}),O(),R(r),G(r),d()}function O(){const t=l.sort;t!=="default"&&(e.categorySections.forEach(r=>{const i=r.querySelector(".grid");if(!i)return;const a=Array.from(i.querySelectorAll(".product-card:not(.hidden)"));L(a,t).forEach(c=>i.appendChild(c))}),e.categorySectionsLis.forEach(r=>{const i=r.querySelector(".space-y-3");if(!i)return;const a=Array.from(i.querySelectorAll(".product-card-list:not(.hidden)"));L(a,t).forEach(c=>i.appendChild(c))}))}function L(t,r){return[...t].sort((i,a)=>{const s=i.dataset.name||"",c=a.dataset.name||"";switch(r){case"name-asc":return s.localeCompare(c);case"name-desc":return c.localeCompare(s);default:return 0}})}function R(t){e.productCount&&(e.productCount.textContent=`${t} product${t!==1?"s":""}`)}function G(t){e.emptyState&&(t===0?(e.emptyState.classList.remove("hidden"),e.productGrid?.classList.add("hidden"),e.productList?.classList.add("hidden")):(e.emptyState.classList.add("hidden"),u==="grid"?e.productGrid?.classList.remove("hidden"):e.productList?.classList.remove("hidden")))}function d(){const t=[];if(l.search&&t.push({label:"Search",value:`"${l.search}"`,type:"search"}),l.category!=="all"){const i=document.querySelector(`label[for="cat-${l.category}"]`)?.textContent?.split("(")[0].trim()||l.category;t.push({label:"Type",value:i,type:"category"})}l.imlOnly&&t.push({label:"Filter",value:"IML Only",type:"iml"}),e.activeFiltersBadge&&(t.length>0?(e.activeFiltersBadge.textContent=t.length.toString(),e.activeFiltersBadge.classList.remove("hidden")):e.activeFiltersBadge.classList.add("hidden")),e.clearAllFilters&&(t.length>0?e.clearAllFilters.classList.remove("hidden"):e.clearAllFilters.classList.add("hidden")),e.activeFiltersContainer&&(t.length>0?(e.activeFiltersContainer.classList.remove("hidden"),e.activeFiltersContainer.innerHTML=t.map(r=>`
          <span class="inline-flex items-center gap-1 px-3 py-1.5 bg-blue-50 text-[#0A3E49] rounded-full text-sm border border-blue-200">
            <span class="text-[#0A3E49] font-medium">${r.label}:</span> ${r.value}
            <button class="remove-filter ml-1 text-blue-400 hover:text-[#0A3E49] transition-colors" data-type="${r.type}" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
              </svg>
            </button>
          </span>
        `).join(""),e.activeFiltersContainer.querySelectorAll(".remove-filter").forEach(r=>{r.addEventListener("click",$)})):(e.activeFiltersContainer.classList.add("hidden"),e.activeFiltersContainer.innerHTML=""))}function $(t){t.preventDefault(),t.stopPropagation();const i=t.currentTarget.dataset.type||"";if(i==="search")b();else if(i==="category"){l.category="all";const a=document.querySelector('input[data-id="all"]');a&&(a.checked=!0),n(),o(),d()}else if(i==="iml"){const a=document.getElementById("imlFilter");a&&(a.checked=!1),l.imlOnly=!1,y(),n(),o(),d()}}function S(){console.log("Resetting all filters..."),l={search:"",category:"all",sort:"default",imlOnly:!1},e.searchInput&&(e.searchInput.value=""),e.clearSearch?.classList.add("hidden"),e.categoryRadios.forEach(r=>{r.checked=r.dataset.id==="all"}),e.sortSelect&&(e.sortSelect.value="default");const t=document.getElementById("imlFilter");t&&(t.checked=!1),y(),n(),o(),d(),f(),console.log("Filters reset complete")}function D(t){t.key==="Escape"&&e.filtersSidebar&&!e.filtersSidebar.classList.contains("-translate-x-full")&&f(),(t.ctrlKey||t.metaKey)&&t.key==="k"&&(t.preventDefault(),e.searchInput?.focus())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p();function U(){const t=new URLSearchParams(window.location.search),r=t.get("category"),i=t.get("iml");if(r){l.category=r;const a=document.querySelector(`input[name="category-filter"][value="${r}"]`);a&&(a.checked=!0)}if(i==="true"){l.imlOnly=!0;const a=document.getElementById("iml-filter");a&&(a.checked=!0)}n(),o()}window.addEventListener("DOMContentLoaded",U);
